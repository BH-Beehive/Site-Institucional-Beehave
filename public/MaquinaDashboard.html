<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="assets/icons/Beehive.png" type="image/x-icon">
    <!-- fontAwesome -->
    <script src="https://kit.fontawesome.com/7d521e6e81.js" crossorigin="anonymous"></script>
    <!--  -->

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dosis:wght@300&family=Quicksand:wght@300;400&display=swap"
        rel="stylesheet">
    <!--  -->

    <!-- Js chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!--  -->
    <!-- css's -->
    <link rel="stylesheet" href="css/default.css">
    <link rel="stylesheet" href="css/dashboards/styleMaquina.css">
    <!-- css's components -->
    <link rel="stylesheet" href="css/Components/sidebar.css">
    <!-- script -->

    <script>
        window.fwSettings = {
            'widget_id': 150000001309
        };
        !function () { if ("function" != typeof window.FreshworksWidget) { var n = function () { n.q.push(arguments) }; n.q = [], window.FreshworksWidget = n } }() 
    </script>
    <script type='text/javascript' src='https://widget.freshworks.com/widgets/150000001309.js' async defer></script>

    <title>Dashboard | Máquina</title>
</head>

<body onload="listarInformacoesMaquina(), listarDadosMaquina(),iniciarGrafico()">
    <div class="container">

        <!-- Component sideBar -->
        <div class="menuLateral">
            <div class="logo">
                <img class="img-icon" src="./assets/img/Beehive_logo 22 (1).svg" alt=""
                    style="transition: all 0.6s  cubic-bezier(0.125, 0.54, 0.24, 1);">
                <span class="nomeBeehive">Beehive</span>
            </div>
            <hr>
            <div class="itens">
                <div class="item-sidebar">
                    <img src="assets/icons/icon_home.png" alt="">
                    <a href="index.html">
                        <h2 class="item">Home</h2>
                    </a>
                </div>
                <div class="item-sidebar agora">
                    <img src="assets/icons/icon_dashboard.png" alt="">
                    <a href="PrimaryDashboard.html">
                        <h2 class="item">Dashboard</h2>
                    </a>
                </div>
                <div class="item-sidebar">
                    <img class="img-gerenciar-user" src="assets/icons/icon_gerenciar_user.png" alt="">
                    <a href="gerenciarContas.html">
                        <h2 class="item">Gerenciar</h2>
                    </a>
                </div>
                <div class="item-sidebar">
                    <img class="img-gerenciar-user" src="assets/icons/suporte_icon.png" alt="">
                    <a href="perfilSuporte.html">
                        <h2 class="item">Suporte</h2>
                    </a>
                </div>
            </div>
            <hr>
            <div class="sair">
                <a href="index.html"><img src="assets/icons/saida_icon.png" alt=""></a>
            </div>

        </div>
        <div class="main-content" style="background-color: #f9f9f9;">

            <!-- Component header -->
            <div class="itens-navbar">
                <button class="button-navbar">Download Cliente</button>
                <img class="img-navbar" src="../public/assets/img/icone-avatar-default.png" alt="">
            </div>
            <!-- Component header -->

            <div class="background" sty>
                <div class="content">
                    <div class="informationAndInputs">
                        <div class="iconBack"><a href="PrimaryDashboard.html"><i class="fa-solid fa-arrow-left"></i></a>
                        </div>


                    </div>

                    <div class="cardAndChartBackground" style="background-color: red;">
                        <div class="cardInfoMaquinaBackground">
                            <div class="content" id="listaInformacoes">
                                <h2>Maquina 2</h2>
                                <div class="infosMaquina">
                                    <div class="itemInfoMaquina">
                                        <h4>Processador</h4>
                                        <p>Intel i7</p>
                                    </div>

                                    <div class="itemInfoMaquina">
                                        <h4>Arquitetura</h4>
                                        <p>64 bits</p>
                                    </div>
                                    <div class="itemInfoMaquina">
                                        <h4>SO</h4>
                                        <p>Windows</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="lineChartBackground" style="background-color: black;">
                            <div class="content">
                                <div class="infosOfLineChart">
                                   
                                    <div class="selects">
                                        <h3>Componente:</h3>
                                        <h2>CPU</h2>
                                    </div>

                                </div>

                                <script>

                                    let hostName = sessionStorage.NOME_MAQUINA;
                                    
                                    let dadosDiscoTotal = 0
                                    let dadosDiscoUsado = 0
                                    var proximaAtualizacao;
                                    
                                    function iniciarGrafico() {


                                        const horaRegistro = []
                                        const dados = []
                                        const data = {
                                            labels: horaRegistro,
                                            datasets: [{
                                                label: "CPU",
                                                backgroundColor: '#28AEF3',
                                                borderColor: '#28AEF3',
                                                data: dados,
                                            }]
                                        };

                                        const config = {
                                            type: 'line',
                                            data: data,
                                            options: {}
                                        };

                                        const chart = new Chart(
                                            document.getElementById('myChart'),
                                            config
                                        );




                                        const data2 = {
                                            labels: ["%Disco usado", "%Disco disponível"],
                                            datasets: [{
                                                label: 'DISCO',
                                                data: [0, 0],
                                                backgroundColor: [
                                                    'red',
                                                    'limegreen'

                                                ],
                                                hoverOffset: 4,
                                                options: {

                                                }
                                            }]
                                        };

                                        const config2 = {
                                            type: 'pie',
                                            data: data2,
                                            options: {
                                                scales: {
                                                },
                                                plugins: {
                                                    tooltip: {
                                                        enabled: false
                                                    },
                                                    datalabels: {
                                                        formatter: (value, context) => { return `${value}%` },
                                                        color:["white"],
                                                        font: {
                                                            size: 34
                                                        }
                                                    }
                                                }

                                            },
                                            plugins: [ChartDataLabels]
                                        };

                                        const chart2 = new Chart(
                                            document.getElementById('myChartDisco'),
                                            config2
                                        );

                                        const horaRegistro3 = []
                                        const dadosRAM = []
                                        const data3 = {
                                            labels: horaRegistro3,
                                            datasets: [{
                                                label: "RAM",
                                                backgroundColor: 'red',
                                                borderColor: 'red',
                                                data: dadosRAM,
                                            }]
                                        };

                                        const config3 = {
                                            type: 'line',
                                            data: data3,
                                            options: {}
                                        };

                                        const chart3 = new Chart(
                                            document.getElementById('myChartRAM'),
                                            config3
                                        );

                                        setTimeout(() => atualizarGraficoCPU(chart), 3000);
                                        setTimeout(() => atualizarGraficoDisco(chart2), 3000);
                                        setTimeout(() => atualizarGraficoRAM(chart3), 3000);
                                    }






                                    let contador = []
                                    function atualizarGraficoCPU(chartCPU) {
                                        fetch(`registro/registroGraficoLinhaTempo/${hostName}`, {
                                            method: "GET",
                                            headers: { "Content-Type": "application/json" }
                                        }).then(function (resposta) {
                                            resposta.json().then(function (resultado) {

                                                console.log('resultado', resultado)
                                                contador.push(1)
                                                const horaRegistro = resultado.map(dataRegistrada => dataRegistrada.data_registro);
                                                const dadosCPU = resultado.map(dadoCPU => dadoCPU.cpu_uso);
                                                console.log(horaRegistro)
                                                console.log(dadosCPU)
                                                if (contador.length >= 10) {

                                                    chartCPU.data.datasets[0].data.shift();
                                                    chartCPU.data.labels.shift()
                                                }
                                                chartCPU.data.labels.push(horaRegistro);
                                                chartCPU.data.datasets[0].data.push(resultado[0].cpu_uso);

                                                chartCPU.update();
                                                proximaAtualizacao = setTimeout(() => atualizarGraficoCPU(chartCPU), 3000);

                                                if (resposta.ok) {
                                                    console.log("resposta: ", resposta.json());



                                                } else {
                                                    throw ("Houve um erro ao tentar realizar a busca por data!");
                                                }

                                            }).catch(function (res) {
                                                console.log("#ERRO: "`${res}`);
                                            });
                                        })


                                    }






                                    function atualizarGraficoDisco(chartDisco) {
                                        fetch(`registro/registroGraficoLinhaTempo/${hostName}`, {
                                            method: "GET",
                                            headers: { "Content-Type": "application/json" }
                                        }).then(function (resposta) {
                                            resposta.json().then(function (resultado) {

                                                console.log('resultado', resultado)

                                                const horaRegistro = resultado.map(dataRegistrada => dataRegistrada.data_registro);
                                                const dadosDisco = resultado.map(dadoDisco => dadoDisco.disco_uso);
                                                dadosDiscoTotal = resultado[0].disco_total
                                                dadosDiscoUsado = resultado[0].disco_uso

                                                console.log("XXXXXXX" + dadosDiscoTotal)
                                                console.log("XXXXXXX" + dadosDiscoUsado)
                                                console.log(horaRegistro);
                                                console.log(dadosDisco);

                                                chartDisco.data.datasets[0].data = [dadosDiscoUsado, 100 - dadosDiscoUsado];

                                                chartDisco.update();
                                                proximaAtualizacao = setTimeout(() => atualizarGraficoDisco(chartDisco), 3000);

                                                if (resposta.ok) {
                                                    console.log("resposta: ", resposta.json());



                                                } else {
                                                    throw ("Houve um erro ao tentar realizar a busca por data!");
                                                }

                                            }).catch(function (res) {
                                                console.log("#ERRO: "`${res}`);
                                            });
                                        })


                                    }






                                    let contador3 = []
                                    function atualizarGraficoRAM(chartRAM) {
                                        fetch(`registro/registroGraficoLinhaTempo/${hostName}`, {
                                            method: "GET",
                                            headers: { "Content-Type": "application/json" }
                                        }).then(function (resposta) {
                                            resposta.json().then(function (resultado) {

                                                console.log('resultado', resultado)
                                                contador3.push(1)
                                                const horaRegistro = resultado.map(dataRegistrada => dataRegistrada.data_registro);
                                                const dadosRAM = resultado.map(dadoRAM => dadoRAM.memoria_uso);
                                                console.log(horaRegistro)
                                                console.log(dadosRAM)
                                                if (contador3.length >= 10) {

                                                    chartRAM.data.datasets[0].data.shift();
                                                    chartRAM.data.labels.shift()
                                                }

                                                chartRAM.data.labels.push(horaRegistro);
                                                chartRAM.data.datasets[0].data.push(resultado[0].memoria_uso);

                                                chartRAM.update();
                                                proximaAtualizacao = setTimeout(() => atualizarGraficoRAM(chartRAM), 3000);

                                                if (resposta.ok) {
                                                    console.log("resposta: ", resposta.json());



                                                } else {
                                                    throw ("Houve um erro ao tentar realizar a busca por data!");
                                                }

                                            }).catch(function (res) {
                                                console.log("#ERRO: "`${res}`);
                                            });
                                        })


                                    }
                                </script>
                                <div class="chartline">
                                    <canvas height="70%" id="myChart"></canvas>
                                </div>


                            </div>
                        </div>
                        <div class="lineChartBackground">
                            <div class="content">
                                <div class="infosOfLineChart">
                                 
                                    <div class="selects">
                                        <h3>Componente:</h3>
                                        <h2>DISCO</h2>
                                    </div>

                                </div>

                                <div class="chartPizza">
                                    <canvas height="70%" id="myChartDisco"></canvas>
                                </div>

                            </div>
                        </div>
                        <div class="lineChartBackground">
                            <div class="content">
                                <div class="infosOfLineChart">
                                    <div class="selects">
                                        <h3>Componente:</h3>
                                        <h2>RAM</h2>
                                    </div>

                                </div>

                                <div class="chartline">
                                    <canvas height="70%" id="myChartRAM"></canvas>
                                </div>
                                <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.0/dist/chart.min.js"></script>
                                <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

                            </div>
                        </div>
                    </div>

                    <div class="bottomPart">

                        <div class="componentsAndProcessos">

                            <div class="backgroundComponents">
                                <div class="background">
                                    <div class="content" id="dadosComponentes">
                                        <div class="infoComponents">
                                            <p>Histórico de alertas</p>
                                            <h3 id="h3NomeMaquina">Máquina 3</h3>
                                        </div>

                                        <div class="labelsComponents">
                                            <p>#</p>
                                            <p>Nome</p>
                                            <p>Porcentagem em uso</p>
                                        </div>

                                        <div class="contentOfProgressBarComponents">

                                            <div class="itemProgressBarComponents">
                                                <h4>01</h4>
                                                <h5>RAM</h5>
                                                <div class="progressBarFullComponent">
                                                    <div class="progressBarInsideComponentRam divVermelhoComponent"
                                                        id="alterarRam">

                                                    </div>
                                                </div>

                                                <div class="porcentComponent porcentComponentVermelho">
                                                    <span>0</span>%
                                                </div>
                                            </div>

                                            <div class="itemProgressBarComponents">
                                                <h4>01</h4>
                                                <h5>CPU</h5>
                                                <div class="progressBarFullComponent"
                                                    id="progressBarInsideComponentCpu">
                                                    <div class="progressBarInsideComponentCpu">

                                                    </div>
                                                </div>

                                                <div class="porcentComponent porcentComponentAzulClaro">
                                                    <span>0</span>%
                                                </div>
                                            </div>

                                            <div class="itemProgressBarComponents">
                                                <h4>02</h4>
                                                <h5>DISCO</h5>
                                                <div class="progressBarFullComponent">
                                                    <div class="progressBarInsideComponentDisco divAmarelaComponent"
                                                        id="alterarDisco">

                                                    </div>
                                                </div>

                                                <div class="porcentComponent porcentComponentAmarelo">
                                                    <span>0</span>%
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <script src="js/dashBoards/maquinaDashboard.js"></script>
</body>

</html>